!function(e){function n(n){function t(t,a,c){var l=null,r=null!=a?a.toLowerCase():e(n).find(".marker-type").val();if("point"==r)l=new ymaps.Placemark(t,{hintContent:acf_yandex_locale.mark_hint},{draggable:!0});else{var d=null!=c?c:parseInt(e(n).find(".circle-size").val())/2;l=new ymaps.Circle([t,d],{hintContent:acf_yandex_locale.mark_hint},{draggable:!0,opacity:.5,fillOpacity:.1,fillColor:"#DB709377",strokeColor:"#990066",strokeOpacity:.7,strokeWidth:5})}l.events.add("contextmenu",function(){i.geoObjects.remove(this),o()},l),l.events.add("dragend",function(){o()}),i.geoObjects.add(l),o()}function o(){l.zoom=i.getZoom();var n=i.getCenter();l.center_lat=n[0],l.center_lng=n[1];var t=i.getType().split("#");l.type=t[1]?t[1]:"map";var o=[];i.geoObjects.each(function(e){var n=e.geometry.getType();o.push({type:n,coords:e.geometry.getCoordinates(),circle_size:"Circle"==n?e.geometry.getRadius():0})}),l.marks=o,e(c).val(JSON.stringify(l))}var a,c,l,i;return a=e(n).find(".map"),c=n.find(".map-input"),void 0==a||void 0==c?(console.error(acf_yandex_locale.map_init_fail),!1):(l=e.parseJSON(e(c).val()),ymaps.ready(function(){i=new ymaps.Map(a[0],{zoom:l.zoom,center:[l.center_lat,l.center_lng],type:l.type},{minZoom:10}),i.controls.remove("trafficControl"),i.controls.remove("fullscreenControl"),i.copyrights.add("&copy; Const Lab. "),i.events.add("click",function(e){t(e.get("coords"))}),i.events.add("typechange",function(e){o()}),i.events.add("boundschange",function(){o()});var n=i.controls.get("searchControl");n.options.set({noPlacemark:!0,useMapBounds:!1,noSelect:!0,kind:"locality",width:250}),n.events.add("resultselect",function(){i.geoObjects.removeAll(),o()});var c=i.controls.get("geolocationControl");c.events.add("locationchange",function(){i.geoObjects.removeAll(),o()});var r=new ymaps.control.ZoomControl;r.events.add("zoomchange",function(e){o()}),i.controls.add(r,{top:75,left:5});var d=new ymaps.control.Button({data:{content:acf_yandex_locale.btn_clear_all,title:acf_yandex_locale.btn_clear_all_hint},options:{selectOnClick:!1}});d.events.add("click",function(){i.geoObjects.removeAll(),o()}),i.controls.add(d,{top:5,right:5}),e(l.marks).each(function(e,n){t(n.coords,n.type,n.circle_size)})}),void e(".marker-type").on("change",function(){var n=e(this).parent().next("th").children(0),t=e(this).parent().next("th").next("td").children(0);"circle"==this.value?(n.removeClass("hidden"),t.removeClass("hidden")):(n.addClass("hidden"),t.addClass("hidden"))}))}"undefined"!=typeof acf.add_action?acf.add_action("ready append",function(t){acf.get_fields({type:"yandex-map"},t).each(function(){n(e(this))})}):e(document).on("acf/setup_fields",function(t,o){e(o).find('.field[data-field_type="yandex-map"]').each(function(){n(e(this))})})}(jQuery);