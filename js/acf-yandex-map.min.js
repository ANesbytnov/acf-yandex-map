!function(e){function t(t){function n(){l.empty(),null!=s&&(s.destroy(),s=null,c.val("")),s=new ymaps.Map(l[0],{zoom:i.zoom,center:[i.center_lat,i.center_lng],type:"yandex#"+i.type},{minZoom:10}),s.controls.remove("trafficControl"),s.controls.remove("fullscreenControl"),s.behaviors.disable("scrollZoom"),s.copyrights.add("&copy; Const Lab. "),s.events.add("click",function(e){o(e.get("coords")),a()}),s.events.add("typechange",function(e){a()}),s.events.add("boundschange",function(){a()});var n=s.controls.get("searchControl");n.options.set({noPlacemark:!0,useMapBounds:!1,noSelect:!0,kind:"locality",width:250}),n.events.add("resultselect",function(){s.geoObjects.removeAll(),a()});var d=s.controls.get("geolocationControl");d.events.add("locationchange",function(){s.geoObjects.removeAll(),a()});var p=new ymaps.control.ZoomControl;p.events.add("zoomchange",function(e){a()}),s.controls.add(p,{top:75,left:5});var u=new ymaps.control.Button({data:{content:acf_yandex_locale.btn_clear_all,title:acf_yandex_locale.btn_clear_all_hint},options:{selectOnClick:!1}});u.events.add("click",function(){s.balloon.close(),s.geoObjects.removeAll(),a()}),s.controls.add(u,{top:5,right:5}),e(i.marks).each(function(e,t){o(t.coords,t.type,t.circle_size)});var m=s.getCenter();s.balloon.events.add("autopanbegin",function(){m=s.getCenter()}),s.balloon.events.add("close",function(){s.setCenter(m,s.getZoom(),{duration:500})}),s.balloon.events.add("open",function(){e(t).find(".ya-import form").submit(function(){return r(e(this).serializeArray()),!1}),e(t).find(".ya-import textarea, .ya-export textarea").focus().select()});var A=new ymaps.control.Button({data:{image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAqElEQVQ4T+2SMRLCIBBF/xb03kRvoDcJDVt7A5MbWC8N3kRvoDexp8AJM8mQZBPjaCnlZ/+DeUBQlnPuSkT7ciuldPPeH8bj9AcgO7DWbowx28LHmYh2I4l3AMcuizE+QgjPXiIzBwCVJlXJLiJi23zwCishfXkCaIM3kEFZBSxAJuVZgAJRy4uAAoJOmCZY/corXyKP/QbAzDWA0ycnA2hEpM43+AbwAmsIXBGXgRV+AAAAAElFTkSuQmCC",title:acf_yandex_locale.btn_import},options:{selectOnClick:!1}});A.events.add("click",function(){s.balloon.close(),s.balloon.open(s.getBounds()[0],'<div class="ya-import" style="margin: 5px"><p class="description">'+acf_yandex_locale.import_desc+'</p><form><textarea name="import" cols="40" rows="5" autofocus></textarea><br><input type="submit" class="button" name="submit" value="'+acf_yandex_locale.import_go+'"/></form></div>')});var f=new ymaps.control.Button({data:{image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAu0lEQVQ4T+3TsQ3CMBQE0H8bsAErZAMYgQUQUNiCGajp6UD+jSUWCRuwAhukdnNRkBKZYFtJj1v7nqX7NqSwrLWeZK2qPncMuY0uLCK7bp/kIYckgTjcX5BDfoBUuIR8AaVwDhmAKeEU8gGMMRWATXRgD2AZF0zyDWCYRgjh6r1vkiUaY2oAqxHwVNX1eGp/QCTXQUVyERcGoFHV16QSSx8sCVhrLyKynRMUkYdz7tw/pBuA4xyA5F1VTy30F30RrR2UBgAAAABJRU5ErkJggg==",title:acf_yandex_locale.btn_export},options:{selectOnClick:!1}});f.events.add("click",function(){s.balloon.close(),s.balloon.open(s.getBounds()[0],'<div class="ya-export" style="margin: 5px"><p class="description">'+acf_yandex_locale.export_desc+'</p><textarea cols="40" rows="5" readonly>'+JSON.stringify(i)+"</textarea></div>")}),s.controls.add(f,{top:5,right:5}),s.controls.add(A,{top:5,right:5})}function o(n,o,r){var l=null,c=null!=o?o.toLowerCase():e(t).find(".marker-type").val();if("point"==c)l=new ymaps.Placemark(n,{hintContent:acf_yandex_locale.mark_hint},{draggable:!0});else{var i=null!=r?r:parseInt(e(t).find(".circle-size").val())/2;l=new ymaps.Circle([n,i],{hintContent:acf_yandex_locale.mark_hint},{draggable:!0,opacity:.5,fillOpacity:.1,fillColor:"#DB709377",strokeColor:"#990066",strokeOpacity:.7,strokeWidth:5})}l.events.add("contextmenu",function(){s.geoObjects.remove(this),a()},l),l.events.add("dragend",function(){a()}),s.geoObjects.add(l)}function a(){i.zoom=s.getZoom();var t=s.getCenter();i.center_lat=t[0],i.center_lng=t[1];var n=s.getType().split("#");i.type=n[1]?n[1]:"map";var o=[];s.geoObjects.each(function(e){var t=e.geometry.getType();o.push({type:t,coords:e.geometry.getCoordinates(),circle_size:"Circle"==t?e.geometry.getRadius():0})}),i.marks=o,e(c).val(JSON.stringify(i))}function r(t){if(0==t.length)return!1;if("import"!=t[0].name)return!1;try{var o=e.parseJSON(t[0].value)}catch(a){return console.error(a,"Import map error"),alert("Import map error"),!1}return i=o,n(),!1}var l,c,i,s=null;return l=e(t).find(".map"),c=t.find(".map-input"),void 0==l||void 0==c?(console.error(acf_yandex_locale.map_init_fail),!1):(i=e.parseJSON(e(c).val()),ymaps.ready(function(){n()}),void e(".marker-type").on("change",function(){var t=e(this).parent().next("th").children(0),n=e(this).parent().next("th").next("td").children(0);"circle"==this.value?(t.removeClass("hidden"),n.removeClass("hidden")):(t.addClass("hidden"),n.addClass("hidden"))}))}"undefined"!=typeof acf.add_action?acf.add_action("ready append",function(n){acf.get_fields({type:"yandex-map"},n).each(function(){t(e(this))})}):e(document).on("acf/setup_fields",function(n,o){e(o).find('.field[data-field_type="yandex-map"]').each(function(){t(e(this))})})}(jQuery);
//# sourceMappingURL=acf-yandex-map.min.js.map
