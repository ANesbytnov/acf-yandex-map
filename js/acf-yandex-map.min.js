!function(e){function n(n){function t(n,t,c){var i=null,r=null!=t?t.toLowerCase():e(a).find(".marker-type").val();if("point"==r)i=new ymaps.Placemark(n,{hintContent:acf_yandex_locale.mark_hint},{draggable:!0});else{var l=null!=c?c:e(a).find(".circle-size").val();i=new ymaps.Circle([n,l/2],{hintContent:"Перетащите метку. Правый клик - удалить."},{draggable:!0,opacity:.5,fillOpacity:.1,fillColor:"#DB709377",strokeColor:"#990066",strokeOpacity:.7,strokeWidth:5})}i.events.add("contextmenu",function(e){d.geoObjects.remove(this),o()},i),d.geoObjects.add(i),o()}function o(){r.zoom=d.getZoom();var n=d.getCenter();r.center_lat=n[0],r.center_lng=n[1];var t=d.getType().split("#");r.type=t[1]?t[1]:"map";var o=[];d.geoObjects.each(function(e){var n=e.geometry.getType();o.push({type:n,coords:e.geometry.getCoordinates(),circle_size:"Circle"==n?e.geometry.getRadius():0})}),r.marks=o,e(i).val(JSON.stringify(r))}var a,c,i,r,d;if(a=n,c=e(a).find(".map"),i=a.find(".map-input"),void 0==c||void 0==i)return console.error(acf_yandex_locale.map_init_fail),!1;r=e.parseJSON(e(i).val()),console.log(r);var l=(i.attr("data-zoom"),null);ymaps.ready(function(){d=new ymaps.Map(c[0],{zoom:r.zoom,center:[r.center_lat,r.center_lng],type:r.type},{minZoom:10}),d.controls.remove("trafficControl"),d.copyrights.add("&copy; Const Lab. "),d.events.add("click",function(e){l=e.get("coords"),t(l)}),d.events.add("typechange",function(e){o()}),d.events.add("boundschange",function(){o()});var n=d.controls.get("searchControl");n.options.set({noPlacemark:!0,useMapBounds:!1,noSelect:!0,kind:"locality",width:250});var a=new ymaps.control.ZoomControl;a.events.add("zoomchange",function(e){o()}),d.controls.add(a,{top:75,left:5}),e(r.marks).each(function(e,n){t(n.coords,n.type,n.circle_size)})}),e(".marker-type").on("change",function(){var n=e(a).find(".circle");"circle"==this.value?n.removeClass("hidden"):n.addClass("hidden")})}"undefined"!=typeof acf.add_action?acf.add_action("ready append",function(t){acf.get_fields({type:"yandex-map"},t).each(function(){n(e(this))})}):e(document).on("acf/setup_fields",function(t,o){e(o).find('.field[data-field_type="yandex-map"]').each(function(){n(e(this))})})}(jQuery);