{"version":3,"sources":["acf-yandex-map.js"],"names":["$","initialize_field","$el","map_init","$element","empty","$map","destroy","$input","val","ymaps","Map","zoom","$params","center","center_lat","center_lng","type","minZoom","controls","remove","behaviors","disable","copyrights","add","events","e","create_mark","get","save_map","search_controll","options","set","noPlacemark","useMapBounds","noSelect","kind","width","geoObjects","removeAll","geo_control","zoom_control","control","ZoomControl","event","top","left","clear_button","Button","data","content","acf_yandex_locale","btn_clear_all","title","btn_clear_all_hint","selectOnClick","balloon","close","right","marks","each","index","mark","coords","circle_size","getCenter","setCenter","getZoom","duration","find","submit","import_map","this","serializeArray","focus","select","import_button","image","btn_import","open","getBounds","import_desc","import_go","export_button","btn_export","export_desc","JSON","stringify","size","place_mark","marker_type","toLowerCase","Placemark","hintContent","mark_hint","draggable","parseInt","Circle","opacity","fillOpacity","fillColor","strokeColor","strokeOpacity","strokeWidth","getType","split","_type","geometry","push","getCoordinates","getRadius","length","name","imported","parseJSON","value","err","console","error","alert","undefined","map_init_fail","ready","on","label","parent","next","children","removeClass","addClass","acf","add_action","get_fields","document","postbox","jQuery"],"mappings":"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","file":"acf-yandex-map.min.js","sourcesContent":["(function ($) {\n\n    /**\n     * Initialize admin interface\n     *\n     * @param {element} $el\n     * @returns {boolean}\n     */\n    function initialize_field($el) {\n\n        /**\n         * Element for map init\n         * @type {element}\n         */\n        var $element;\n\n        /**\n         * Hidden data input\n         * @type {element}\n         */\n        var $input;\n\n        /**\n         * Saved data or default\n         *\n         * @param {float} $params.center_lat\n         * @param {float} $params.center_lng\n         * @param {string} $params.type\n         * @param {int} $params.zoom\n         * @param {Object[]} $params.marks\n         *\n         * @type {object}\n         */\n        var $params;\n\n        /**\n         * Yandex map object\n         *\n         * @type {Object}\n         */\n        var $map = null;\n\n        /// Init fields\n\n        $element = $($el).find('.map');\n        $input = ($el).find('.map-input');\n\n        if ($element == undefined || $input == undefined) {\n            console.error(acf_yandex_locale.map_init_fail);\n            return false;\n        }\n\n        /// Init params\n\n        $params = $.parseJSON($($input).val());\n\n        /// Init map\n\n        ymaps.ready(function () {\n            map_init();\n        });\n\n        /**\n         * Initialization Map\n         */\n        function map_init() {\n\n            $element.empty();\n\n            if ($map != null) {\n                $map.destroy();\n                $map = null;\n                $input.val('');\n            }\n\n            $map = new ymaps.Map($element[0], {\n                zoom: $params.zoom,\n                center: [$params.center_lat, $params.center_lng],\n                type: 'yandex#' + $params.type\n            }, {\n                minZoom: 10\n            });\n\n            $map.controls.remove('trafficControl');\n            $map.controls.remove('fullscreenControl');\n            $map.behaviors.disable('scrollZoom');\n            $map.copyrights.add('&copy; Const Lab. ');\n\n            $map.events.add('click', function (e) {\n                create_mark(e.get('coords'));\n                save_map();\n            });\n\n            $map.events.add('typechange', function (e) {\n                save_map();\n            });\n\n            $map.events.add('boundschange', function () {\n                save_map();\n            });\n\n            /// Search Control\n\n            var search_controll = $map.controls.get('searchControl');\n            search_controll.options.set({\n                noPlacemark: true,\n                useMapBounds: false,\n                noSelect: true,\n                kind: 'locality',\n                width: 250\n            });\n\n            search_controll.events.add('resultselect', function () {\n                $map.geoObjects.removeAll();\n                save_map();\n            });\n\n            /// Geo location button\n\n            var geo_control = $map.controls.get('geolocationControl');\n            geo_control.events.add('locationchange', function () {\n                $map.geoObjects.removeAll();\n                save_map();\n            });\n\n            /// Zoom Control\n\n            var zoom_control = new ymaps.control.ZoomControl();\n            zoom_control.events.add('zoomchange', function (event) {\n                save_map();\n            });\n\n            $map.controls.add(zoom_control, {top: 75, left: 5});\n\n            /// Clear all button\n\n            var clear_button = new ymaps.control.Button({\n                data: {\n                    content: acf_yandex_locale.btn_clear_all,\n                    title: acf_yandex_locale.btn_clear_all_hint\n                },\n                options: {\n                    selectOnClick: false\n                }\n            });\n\n            clear_button.events.add('click', function () {\n                $map.balloon.close();\n                $map.geoObjects.removeAll();\n                save_map();\n            });\n\n            $map.controls.add(clear_button, {top: 5, right: 5});\n\n            /// Marks load\n\n            $($params.marks).each(function (index, mark) {\n                create_mark(mark.coords, mark.type, mark.circle_size);\n            });\n\n            /// Map balloon\n\n            var center = $map.getCenter();\n\n            $map.balloon.events.add('autopanbegin', function () {\n                center = $map.getCenter();\n            });\n\n            $map.balloon.events.add('close', function () {\n                $map.setCenter(center, $map.getZoom(), {\n                    duration: 500\n                });\n            });\n\n            $map.balloon.events.add('open', function () {\n                $($el).find('.ya-import form').submit(function () {\n                    import_map($(this).serializeArray());\n                    return false;\n                });\n                $($el).find('.ya-import textarea, .ya-export textarea').focus().select();\n            });\n\n            /// Import Export Controls\n\n            var import_button = new ymaps.control.Button({\n                data: {\n                    image: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik0xMi42LDRoLTEuMDIxYy0wLjI3NiwwLTAuNSwwLjIyNC0wLjUsMC41czAuMjI0LDAuNSwwLjUsMC41SDEyLjZDMTMuMzk4LDUsMTQsNS42NDUsMTQsNi41djZjMCwwLjg1NS0wLjYwMiwxLjUtMS40LDEuNWgtMTBDMS43NDgsMTQsMSwxMy4yOTksMSwxMi41di02QzEsNS43MDEsMS43NDgsNSwyLjYsNWgwLjc2OGMwLjI3NiwwLDAuNS0wLjIyNCwwLjUtMC41UzMuNjQ1LDQsMy4zNjgsNEgyLjZDMS4xOTEsNCwwLDUuMTQ1LDAsNi41djZDMCwxMy44NTUsMS4xOTEsMTUsMi42LDE1aDEwYzEuMzQ2LDAsMi40LTEuMDk4LDIuNC0yLjV2LTZDMTUsNS4wOTgsMTMuOTQ1LDQsMTIuNiw0eiIvPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik03LjEzMywxMC4wMzRjMC4xMzcsMC4zMTUsMC41NjgsMC40MTMsMC43MDMsMC4xMDFjMC4wMTItMC4wMjksMS4xNzctMi40MTksMS45MjktMy4zNzNjMC4yNjQtMC4zMzUtMC4wOTUtMC42NC0wLjQ2My0wLjUzQzguOTgsNi4zMjgsNy45NjYsNy4wNTIsNy45NjYsNy4xMDFWMC41NzZjMC0wLjI3Ni0wLjE4OC0wLjU5MS0wLjQ2NS0wLjU5MWMtMC4wMDIsMC0wLjAwMywwLjAwMS0wLjAwNSwwLjAwMXMwLjAwMS0wLjAwMS0wLjAwMS0wLjAwMWMtMC4yNzYsMC0wLjQ5NSwwLjIyNC0wLjQ5NSwwLjVWNy4wMWMwLTAuMDQ5LTEuMDE4LTAuNzc0LTEuMzM5LTAuODY5Yy0wLjM2OC0wLjExLTAuNzE4LDAuMTg3LTAuNDY2LDAuNTNDNS44Nyw3LjU4Nyw2LjY1OSw4Ljk0Myw3LjEzMywxMC4wMzR6Ii8+PC9nPjwvc3ZnPg==',\n                    title: acf_yandex_locale.btn_import\n                },\n                options: {\n                    selectOnClick: false\n                }\n            });\n\n            import_button.events.add('click', function () {\n                $map.balloon.close();\n                $map.balloon.open($map.getBounds()[0], '<div class=\"ya-import\" style=\"margin: 5px\"><p class=\"description\">' + acf_yandex_locale.import_desc + '</p><form><textarea name=\"import\" cols=\"40\" rows=\"5\" autofocus></textarea><br><input type=\"submit\" class=\"button\" name=\"submit\" value=\"' + acf_yandex_locale.import_go + '\"/></form></div>');\n\n            });\n\n            var export_button = new ymaps.control.Button({\n                data: {\n                    image: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik0xMi42LDRoLTEuMDIxYy0wLjI3NiwwLTAuNSwwLjIyNC0wLjUsMC41czAuMjI0LDAuNSwwLjUsMC41SDEyLjZDMTMuMzk4LDUsMTQsNS42NDUsMTQsNi41djZjMCwwLjg1NS0wLjYwMiwxLjUtMS40LDEuNWgtMTBDMS43NDgsMTQsMSwxMy4yOTksMSwxMi41di02QzEsNS43MDEsMS43NDgsNSwyLjYsNWgwLjc2OGMwLjI3NiwwLDAuNS0wLjIyNCwwLjUtMC41UzMuNjQ1LDQsMy4zNjgsNEgyLjZDMS4xOTEsNCwwLDUuMTQ1LDAsNi41djZDMCwxMy44NTUsMS4xOTEsMTUsMi42LDE1aDEwYzEuMzQ2LDAsMi40LTEuMDk4LDIuNC0yLjV2LTZDMTUsNS4wOTgsMTMuOTQ1LDQsMTIuNiw0eiIvPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik03Ljg2OCwwLjIyNWMtMC4xMzctMC4zMTUtMC42MDItMC4zMjItMC43MzctMC4wMUM3LjExOCwwLjI0NCw1Ljk1NCwyLjYzNCw1LjIwMiwzLjU4OGMtMC4yNjQsMC4zMzUsMC4wOTUsMC42NCwwLjQ2MywwLjUzQzUuOTg2LDQuMDIyLDcsMy4yOTgsNywzLjI0OXY2LjUyNmMwLDAuMjc2LDAuMjIzLDAuNSwwLjQ5OSwwLjVjMC4wMDIsMCwwLjAwMy0wLjAwMSwwLjAwNS0wLjAwMXMtMC4wMDEsMC4wMDEsMC4wMDEsMC4wMDFjMC4yNzYsMCwwLjQ5NS0wLjIyNCwwLjQ5NS0wLjVWMy4yNDljMCwwLjA0OSwxLjAxOCwwLjc3NCwxLjMzOSwwLjg2OWMwLjM2OCwwLjExLDAuNzE4LTAuMTg3LDAuNDY2LTAuNTNDOS4xMzEsMi42NzEsOC4zNDEsMS4zMTUsNy44NjgsMC4yMjV6Ii8+PC9nPjwvc3ZnPg==',\n                    title: acf_yandex_locale.btn_export\n                },\n                options: {\n                    selectOnClick: false\n                }\n            });\n\n            export_button.events.add('click', function () {\n                $map.balloon.close();\n\n                $map.balloon.open($map.getBounds()[0], '<div class=\"ya-export\" style=\"margin: 5px\"><p class=\"description\">' + acf_yandex_locale.export_desc + '</p><textarea cols=\"40\" rows=\"5\" readonly>'\n                + JSON.stringify($params) + '</textarea></div>');\n            });\n\n            $map.controls.add(export_button, {top: 5, right: 5});\n            $map.controls.add(import_button, {top: 5, right: 5});\n        }\n\n        /**\n         * Create geo mark\n         *\n         * @param {Array} coords\n         * @param {string} type Point type, Point or Circle\n         * @param {int} size Circle size in meters\n         */\n        function create_mark(coords, type, size) {\n\n            var place_mark = null;\n            var marker_type = (type != null) ? type.toLowerCase() : $($el).find('.marker-type').val();\n\n            if (marker_type == 'point') { // create placemark\n\n                place_mark = new ymaps.Placemark(\n                    coords,\n                    {\n                        //balloonContent: 'test',\n                        hintContent: acf_yandex_locale.mark_hint\n                    }, {\n                        draggable: true\n                    }\n                );\n\n            } else { // if mark is circle\n\n                var circle_size = (size != null) ? size : (parseInt($($el).find('.circle-size').val()) / 2);\n\n                place_mark = new ymaps.Circle([\n                    coords,\n                    circle_size\n                ], {\n                    hintContent: acf_yandex_locale.mark_hint\n                }, {\n                    draggable: true,\n                    opacity: 0.5,\n                    fillOpacity: 0.1,\n                    fillColor: \"#DB709377\",\n                    strokeColor: \"#990066\",\n                    strokeOpacity: 0.7,\n                    strokeWidth: 5\n                });\n\n            }\n\n            place_mark.events.add('contextmenu', function () {\n                $map.geoObjects.remove(this);\n                save_map();\n            }, place_mark);\n\n            place_mark.events.add('dragend', function () {\n                save_map();\n            });\n\n            /*place_mark.events.add('click', function () {\n                if (!this.balloon.isOpen()) {\n                    show_mark_editor(this);\n                }\n            }, place_mark);*/\n\n            $map.geoObjects.add(place_mark);\n        }\n\n        /**\n         * Write map data in hidden field\n         */\n        function save_map() {\n\n            $params.zoom = $map.getZoom();\n\n            var coords = $map.getCenter();\n            $params.center_lat = coords[0];\n            $params.center_lng = coords[1];\n\n            var type = $map.getType().split('#');\n            $params.type = (type[1]) ? type[1] : 'map';\n\n            var marks = [];\n            $map.geoObjects.each(function (mark) {\n                var _type = mark.geometry.getType();\n                marks.push({\n                    type: _type,\n                    coords: mark.geometry.getCoordinates(),\n                    circle_size: (_type == 'Circle') ? mark.geometry.getRadius() : 0\n                });\n            });\n            $params.marks = marks;\n\n            $($input).val(JSON.stringify($params));\n        }\n\n        /**\n         * Import map from json\n         * @param data\n         * @returns {boolean}\n         */\n        function import_map(data) {\n\n            if (data.length == 0)\n                return false;\n\n            if (data[0].name != 'import')\n                return false;\n\n            try {\n                var imported = $.parseJSON(data[0].value);\n            }\n            catch (err) {\n                console.error(err, 'Import map error');\n                alert('Import map error');\n                return false;\n            }\n\n            $params = imported;\n\n            map_init();\n\n            return false;\n        }\n\n        /**\n         * Show mark editor\n         * @param mark\n         */\n        function show_mark_editor(mark) {\n            var html = '<div class=\"ya-editor\" style=\"margin: 5px\"><textarea rows=\"5\" cols=\"40\"></textarea><button class=\"button button-primary\">Save</button>&nbsp;<button class=\"button\">Remove</button></div>';\n            $map.balloon.open(mark.geometry.getCoordinates(), html);\n        }\n\n        /**\n         * Change marker type state\n         */\n        $('.marker-type').on('change', function () {\n            var label = $(this).parent().next('th').children(0);\n            var select = $(this).parent().next('th').next('td').children(0);\n            if (this.value == 'circle') {\n                label.removeClass('hidden');\n                select.removeClass('hidden');\n            } else {\n                label.addClass('hidden');\n                select.addClass('hidden');\n            }\n        });\n\n    }\n\n\n    if (typeof acf.add_action !== 'undefined') {\n\n        /*\n         *  ready append (ACF5)\n         *\n         *  These are 2 events which are fired during the page load\n         *  ready = on page load similar to $(document).ready()\n         *  append = on new DOM elements appended via repeater field\n         *\n         *  @type\tevent\n         *  @date\t20/07/13\n         *\n         *  @param\t$el (jQuery selection) the jQuery element which contains the ACF fields\n         *  @return\tn/a\n         */\n\n        acf.add_action('ready append', function ($el) {\n\n            // search $el for fields of type 'FIELD_NAME'\n            acf.get_fields({type: 'yandex-map'}, $el).each(function () {\n\n                initialize_field($(this));\n\n            });\n\n        });\n\n\n    } else {\n\n\n        /*\n         *  acf/setup_fields (ACF4)\n         *\n         *  This event is triggered when ACF adds any new elements to the DOM.\n         *\n         *  @type\tfunction\n         *  @since\t1.0.0\n         *  @date\t01/01/12\n         *\n         *  @param\tevent\t\te: an event object. This can be ignored\n         *  @param\tElement\t\tpostbox: An element which contains the new HTML\n         *\n         *  @return\tn/a\n         */\n\n        $(document).on('acf/setup_fields', function (e, postbox) {\n\n            $(postbox).find('.field[data-field_type=\"yandex-map\"]').each(function () {\n\n                initialize_field($(this));\n\n            });\n\n        });\n\n\n    }\n\n\n})(jQuery);"],"sourceRoot":"/source/"}